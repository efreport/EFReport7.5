<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>我的桌面</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <style>
        html, body {
            border: 0px;
            margin: 0px;
            padding: 0px;
            height: 100%;
            background-color: #fcfcfc !important;
        }
        /* 将背景颜色都改为#fcfcfc hk->20221223改 */
        .layuimini-container {
            background-color: #fcfcfc !important;
        }
        
        .layui-card {border:1px solid #f2f2f2;border-radius:5px;}
        .icon {margin-right:10px;color:#1aa094;}
        .icon-cray {color:#ffb800!important;}
        .icon-blue {color:#1e9fff!important;}
        .icon-tip {color:#ff5722!important;}
        .layuimini-qiuck-module {text-align:center;margin-top: 10px}
        .layuimini-qiuck-module a i {display:inline-block;width:100%;height:60px;line-height:60px;text-align:center;border-radius:2px;font-size:30px;background-color:#F8F8F8;color:#333;transition:all .3s;-webkit-transition:all .3s;}
        .layuimini-qiuck-module a cite {position:relative;top:2px;display:block;color:#666;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-size:14px;}
        .welcome-module {width:100%;height:210px;}
        .panel {background-color:#fff;border:1px solid transparent;border-radius:3px;-webkit-box-shadow:0 1px 1px rgba(0,0,0,.05);box-shadow:0 1px 1px rgba(0,0,0,.05)}
        .panel-body {padding:10px}
        .panel-title {margin-top:0;margin-bottom:0;font-size:12px;color:inherit}
        .label {display:inline;padding:.2em .6em .3em;font-size:75%;font-weight:700;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:.25em;margin-top: .3em;}
        .layui-red {color:red}
        .main_btn > p {height:40px;}
        .layui-bg-number {background-color:#F8F8F8;}
        .layuimini-notice:hover {background:#f6f6f6;}
        .layuimini-notice {padding:7px 16px;clear:both;font-size:12px !important;cursor:pointer;position:relative;transition:background 0.2s ease-in-out;}
        .layuimini-notice-title,.layuimini-notice-label {
            padding-right: 70px !important;text-overflow:ellipsis!important;overflow:hidden!important;white-space:nowrap!important;}
        .layuimini-notice-title {line-height:28px;font-size:14px;}
        .layuimini-notice-extra {position:absolute;top:50%;margin-top:-8px;right:16px;display:inline-block;height:16px;color:#999;}
        #welcome_title {
            width: 100%;
            height: 50px;
            line-height: 50px;
            vertical-align: middle;
            background-color: #f2f3f5;
        }
        #welcome_content {
            position: absolute;
            width: 100%;
            height: 28px;
            font-size: 20px;
            font-family: PingFang SC-Medium, PingFang SC;
            font-weight: 500;
            color: #000000;
            line-height: 28px;
            --webkit-background-clip: text;
            --webkit-text-fill-color: transparent;
            top: 280px;
            text-align: center;
        }
        #welcome_image {
            position: absolute;
            width: 100%;
            line-height: 28px;
            --webkit-background-clip: text;
            --webkit-text-fill-color: transparent;
            top: 340px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="welcome_main" style="padding: 0px; margin: 0px; position: relative; width: 100%; height: 100%; background-color: #fcfcfc;">
        <!-- 837px, 544px-->
        <div id="div_img_center" style="position: absolute; width: 670px; height: 435px;" >
            <img src="../imgs/welcome.png" width="670px" height="435px"/>
        </div>
        <div id="div_iframe_first" style="display: none;">
            <iframe id="myifr" src="" width="100%" height="100%" frameborder="no" border="0" marginwidth="0" marginheight="0"></iframe>
        </div>
    </div>
<script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
<script>
    layui.use(['layer', 'miniTab','echarts'], function () {
        var $ = layui.jquery,
            layer = layui.layer,
            miniTab = layui.miniTab,
            echarts = layui.echarts;

        miniTab.listen();

        $(function(){
            let width = $("#welcome_main").width();
            let height = $("#welcome_main").height();

            let l = ( parseInt(width) - 837 ) / 2;
            let t = ( parseInt(height) - 544 ) / 2;
            $("#div_img_center").css("top", t + "px");
            $("#div_img_center").css("left", l + "px");
        });

        window.onresize = function(){
            let width = $("#welcome_main").width();
            let height = $("#welcome_main").height();

            let l = ( parseInt(width) - 837 ) / 2;
            let t = ( parseInt(height) - 544 ) / 2;
            $("#div_img_center").css("top", t + "px");
            $("#div_img_center").css("left", l + "px");

            var p_window = window.top;
            let contentHeight =$(p_window).height();
            $("#myifr").attr("height", (contentHeight - 42) + "px");
        }


        let initPage = function() {
            let server_base_url = window.sessionStorage.getItem("ef_server_base_url");
            let token = window.sessionStorage.getItem("cur_token");
            let userType = window.sessionStorage.getItem("cur_userType");
            if (userType === "3") {
                // 预览账户，所以接下来我们需要将用户的home信息取出
                let efurl = server_base_url + "/user/loadUserById?token=" + token;
                $.ajax({
                    url: efurl,
                    type: 'post',
                    success: function (res) {
                       if (res.state === "success") {
                         if (res.data !== null) {
                            if (res.data.home!==null && res.data.home !== "") {
                                // 将当前用户的 自定义首页保存起来
                                window.sessionStorage.setItem("cur_user_home", res.data.home);

                                let home = JSON.parse(res.data.home);
                                let tempid = home.id;
                                let tempname = home.tpl;
                                $("#div_img_center").hide();
                                $("#div_iframe_first").show();
                                // let openUrl = server_base_url + "/report.html?token=" + token + "&id=" + tempid + "&templateName=" + tempname;
                                let sysname = window.sessionStorage.getItem("sys_name");
                                let openUrl = server_base_url + "/report.html?token=" + token + "&id=" + tempid +"&sysname="+sysname;
                                $("#myifr").attr("src", openUrl);

                                var p_window = window.top;
                                let contentHeight =$(p_window).height();
                                $("#myifr").attr("height", (contentHeight - 42) + "px");
                            }
                         }
                       }
                    },
                    error: function () {
                    }
                });


            }
        }

        initPage();

    });
</script>
</body>
</html>
