<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, no-store">
    <meta http-equiv="expires" content="0">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../design/js/css/layui.css">
    <style type="text/css">
        html {
            width: 100%;
            height: 100%;
        }

        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body>
<div style="width: 100%;height:80%;overflow:hidden;justify-content:center;" id="rule">
    <div style="width: 100%;height:100%;display:flex;overflow:hidden;justify-content:center;padding-top: 20px;">
        <div style="width:10%;height:36px;display: flex;align-items: center;justify-content: center;">
            <select style="width: 90%;height:36px;border: 1px solid #E6E6E6;" id="sendType">
                <option value="0">用户</option>
                <option value="1">角色</option>
            </select>
        </div>
        <div style="width:40%;height:36px;display: flex;align-items: center;justify-content: center;position: relative;">
            <div name="shape" style="width: 90%;height:36px;position: absolute;top:0px;" id="send"></div>
        </div>
        <div style="width:10%;height:36px;display: flex;align-items: center;justify-content: center;">
            <select style="width: 90%;height:36px;border: 1px solid #E6E6E6;" id="receiveType">
                <option value="0">用户</option>
                <option value="1">角色</option>
            </select>
        </div>
        <div style="width:40%;height:36px;display: flex;align-items: center;justify-content: center;">
            <div name="shape" style="width: 90%;height:36px;" id="receive"></div>
        </div>
    </div>

</div>
</body>


<script type="text/javascript" src="../../js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="../../design/js/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="../../design/js/xm-select.js"></script>
<script type="text/javascript">
    let select;
    let select1;
    let index = 0;

    function init(token , templateId) {

        let base = window.sessionStorage.getItem("ef_server_base_url");
        $.ajax({
            url:base + '/template/getSendRules?templateId=' + templateId + '&token=' + token,
            type:'get',
            success:function(res) {

                let role = res.role;
                let users = res.users;

                select = xmSelect.render({
                    el: '#send',
                    autoRow: true,
                    filterable: true,
                    tree: {
                        show: true,
                        showFolderIcon: true,
                        showLine: true,
                        indent: 20,
                        expandedKeys: [-3],
                    },
                       iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                    theme: {
                        color: '#0094FF',
                    },
                    toolbar: {
                        show: true,
                        list: ['ALL', 'REVERSE', 'CLEAR']
                    },
                    style: {
                        height: '36px',
                    },
                    height: '150px',
                    radio:true,
                    filterable: true,
                    data: res.users
                })

                select1 = xmSelect.render({
                    el: '#receive',
                    autoRow: true,
                    filterable: true,
                    tree: {
                        show: true,
                        showFolderIcon: true,
                        showLine: true,
                        indent: 20,
                        expandedKeys: [-3],
                    },
                       iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                    theme: {
                        color: '#0094FF',
                    },
                    toolbar: {
                        show: true,
                        list: ['ALL', 'REVERSE', 'CLEAR']
                    },
                    style: {
                        height: '36px',
                    },
                    height: '150px',
                    filterable: true,
                    data: res.users
                })

                $('#sendType').unbind().bind('change',function(){
                    if($(this).val() == '1'){
                        select = xmSelect.render({
                            el: '#send',
                            autoRow: true,
                            filterable: true,
                            radio:true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                            style: {
                                height: '36px',
                            },
                            height: '150px',
                            filterable: true,
                            data: res.role
                        })
                    }else{
                        select = xmSelect.render({
                            el: '#send',
                            autoRow: true,
                            filterable: true,
                            radio:true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                            style: {
                                height: '36px',
                            },
                            height: '150px',
                            filterable: true,
                            data: res.users
                        })
                    }

                })

                $('#receiveType').unbind().bind('change',function(){
                    if($(this).val() == '1'){
                        select1 = xmSelect.render({
                            el: '#receive',
                            autoRow: true,
                            filterable: true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                            style: {
                                height: '36px',
                            },
                            height: '150px',
                            filterable: true,
                            data: res.role
                        })
                    }else{
                        select1 = xmSelect.render({
                            el: '#receive',
                            autoRow: true,
                            filterable: true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            style: {
                                height: '36px',
                            },
                            height: '150px',
                            filterable: true,
                            data: res.users
                        })
                    }

                })


            }

        })


    }

    function init1(token , templateId , data) {

        let base = window.sessionStorage.getItem("ef_server_base_url");
        $.ajax({
            url:base + '/template/getSendRules?templateId=' + templateId + '&token=' + token,
            type:'get',
            success:function(res) {

                let role = res.role;
                let users = res.users;

                if(data.senderType == 0){ //发送者为用户
                    $('#sendType').val(data.senderType).prop('selected' , true);
                    select = xmSelect.render({
                        el: '#send',
                        autoRow: true,
                        filterable: true,
                        tree: {
                            show: true,
                            showFolderIcon: true,
                            showLine: true,
                            indent: 20,
                            expandedKeys: [-3],
                        },
                        theme: {
                            color: '#0094FF',
                        },
                        toolbar: {
                            show: true,
                            list: ['ALL', 'REVERSE', 'CLEAR']
                        },
                           iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                        style: {
                            height: '36px',
                        },
                        height: '150px',
                        radio:true,
                        filterable: true,
                        data: res.users
                    })

                    let senderId = data.senderId;
                    select.setValue([senderId]);

                    if(data.receiverType == 0){ //接收者为用户
                        $('#receiveType').val(data.receiverType).prop('selected' , true);
                        select1 = xmSelect.render({
                            el: '#receive',
                            autoRow: true,
                            filterable: true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                            style: {
                                height: '36px',
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            height: '150px',
                            filterable: true,
                            data: res.users
                        })

                        let receiverId = data.receiverId;
                        let array = receiverId.split(',');
                        select1.setValue(array);
                    }else{ //接收者为角色
                        $('#receiveType').val(data.receiverType).prop('selected' , true);
                        select1 = xmSelect.render({
                            el: '#receive',
                            autoRow: true,
                            filterable: true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                            style: {
                                height: '36px',
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            height: '150px',
                            filterable: true,
                            data: res.role
                        })

                        let receiverId = data.receiverId;
                      /*  let ids = receiverId.split(",");
                        let array = [];
                        $.each(ids , function(i,e){
                            let value = {
                                value: parseInt(e)
                            }
                            array.push(value);
                        })
                        select1.setValue(array);*/
                        let array = receiverId.split(',');
                        select1.setValue(array);
                    }
                }else{
                    $('#sendType').val(data.senderType).prop('selected' , true);
                    select = xmSelect.render({
                        el: '#send',
                        autoRow: true,
                        filterable: true,
                        tree: {
                            show: true,
                            showFolderIcon: true,
                            showLine: true,
                            indent: 20,
                            expandedKeys: [-3],
                        },
                        theme: {
                            color: '#0094FF',
                        },
                        toolbar: {
                            show: true,
                            list: ['ALL', 'REVERSE', 'CLEAR']
                        },
                        style: {
                            height: '36px',
                        },
                           iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                        height: '150px',
                        radio:true,
                        filterable: true,
                        data: res.role
                    })

                    let senderId = data.senderId;
                    select.setValue([senderId]);

                    if(data.receiverType == 0){ //接收者为用户
                        $('#receiveType').val(data.receiverType).prop('selected' , true);
                        select1 = xmSelect.render({
                            el: '#receive',
                            autoRow: true,
                            filterable: true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                            style: {
                                height: '36px',
                            },
                            height: '150px',
                            filterable: true,
                            data: res.users
                        })

                        let receiverId = data.receiverId;
                        select1.setValue([receiverId]);
                    }else{ //接收者为角色
                        $('#receiveType').val(data.receiverType).prop('selected' , true);
                        select1 = xmSelect.render({
                            el: '#receive',
                            autoRow: true,
                            filterable: true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                            style: {
                                height: '36px',
                            },
                            height: '150px',
                            filterable: true,
                            data: res.role
                        })

                        let receiverId = data.receiverId;
                        let ids = receiverId.split(",");
                        let array = [];
                        $.each(ids , function(i,e){
                            let value = {
                                value: parseInt(e)
                            }
                            array.push(value);
                        })
                        select1.setValue(array);
                    }


                }




                $('#sendType').unbind().bind('change',function(){
                    if($(this).val() == '1'){
                        select = xmSelect.render({
                            el: '#send',
                            autoRow: true,
                            filterable: true,
                            radio:true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                            style: {
                                height: '36px',
                            },
                            height: '150px',
                            filterable: true,
                            data: res.role
                        })
                    }else{
                        select = xmSelect.render({
                            el: '#send',
                            autoRow: true,
                            filterable: true,
                            radio:true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                            style: {
                                height: '36px',
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            height: '150px',
                            filterable: true,
                            data: res.users
                        })
                    }

                })

                $('#receiveType').unbind().bind('change',function(){
                    if($(this).val() == '1'){
                        select1 = xmSelect.render({
                            el: '#receive',
                            autoRow: true,
                            filterable: true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                               iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                            style: {
                                height: '36px',
                            },
                            height: '150px',
                            filterable: true,
                            data: res.role
                        })
                    }else{
                        select1 = xmSelect.render({
                            el: '#receive',
                            autoRow: true,
                            filterable: true,
                            tree: {
                                show: true,
                                showFolderIcon: true,
                                showLine: true,
                                indent: 20,
                                expandedKeys: [-3],
                            },
                            iconfont: {
                                parent: 'hidden'
                            },
                            strict:false,
                            theme: {
                                color: '#0094FF',
                            },
                            toolbar: {
                                show: true,
                                list: ['ALL', 'REVERSE', 'CLEAR']
                            },
                            style: {
                                height: '36px',
                            },
                            height: '150px',
                            filterable: true,
                            data: res.users
                        })
                    }

                })


            }

        })


    }

    function getRules(){
        let senderType = $('#sendType').val();
        let receiverType = $('#receiveType').val();
        let senderVal = select.getValue();
        let receiverVal = select1.getValue();
        let res = {
            senderType:senderType,
            receiverType:receiverType,
            senderVal:senderVal,
            receiverVal:receiverVal
        }
        return res;
    }

</script>
</html>