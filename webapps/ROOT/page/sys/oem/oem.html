<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>邮件</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../../../css/public.css" media="all">
    <style>
      html, body {
            border: 0px;
            margin: 0px;
            padding: 0px;
            height: 99%;
            background-color: #fcfcfc !important;
        }
      /* 将背景颜色都改为#fcfcfc hk->20221223改 */
      .layuimini-container {
        background-color: #fcfcfc !important;
        border: 0px !important;
      }

      #div_upload_img {
        position: relative; width: 110px; height: 110px; background: #FcFcFc; border-radius: 4px;opacity: 1;
        margin: auto;
      }
      #div_upload_img:hover {
        cursor: pointer;
      }
      #div_upload_img .icon_img {
        position:absolute; top: 28px; left: 43px;width: 24px;height: 24px;
      }

      #div_upload_img_content {
        position: relative; width: 100px; height: 40px; background: #F2F3F5; border-radius: 4px;opacity: 1;
        margin: auto;
        margin-top:65px;
      }

      #div_upload_ico_img {
        position: relative; width: 110px; height: 110px; background: #fcfcfc; border-radius: 4px;opacity: 1;
        margin: auto;
      }
      #div_upload_ico_img:hover {
        cursor: pointer;
      }
      #div_upload_ico_img .icon_img {
        position:absolute; top: 28px; left: 43px;width: 24px;height: 24px;
      }

      #div_upload_ico_img_content {
        position: relative; width: 48px; height: 48px; background: #F2F3F5; border-radius: 4px;opacity: 1;
        margin: auto;
        margin-top:65px;
      }

      #span_upload_img_txt {
        display: block;
        position: absolute;
        top: 60px;
        width: 110px;
        height: 22px;
        text-align: center;
        font-size: 14px;
        font-family: PingFang SC-Medium, PingFang SC;
        font-weight: 500;
        color: #0094FF !important;
        line-height: 22px;
        background-clip: text;
        -webkit-background-clip: text;
      }
      .div_upload_tip {
        padding: 0px;
        width: 120px; height: 20px; line-height: 20px; font-size: 9px;color: #86909C;
        font-family: PingFang SC-Regular, PingFang SC;
        font-weight: 400;
        line-height: 20px;
        text-align: center;
        background-clip: text;
        -webkit-background-clip: text;
      }

      .layui-form-checked[lay-skin=primary] i {
        border-color: #1E9FFF !important;
        background-color: #1E9FFF !important;
        color: #fff;
      }
      .layuimini-main {
        background-color: #fcfcfc !important;
        border: 0px !important;
      }
    </style>
</head>
<body>
<div class="layuimini-container layuimini-page-anim">
    <div class="layuimini-main">
      <div style="height: 40px;line-height: 40px;">
        <div class="layui-btn-container">
          <span style="padding-left: 15px;"></span>
          <button class="layui-btn layui-btn-normal layui-btn-sm" id="btn-refresh"><i class="layui-icon">&#xe666;</i></button>
        </div>
      </div>

        <form class="layui-form" lay-filter="sysoem">
            <input type="hidden" id="id" name="id" />
            <div style="position: relative; width: 770px; height: 50px; margin: auto;"></div>
            <div style="position: relative; width: 770px; height: auto; margin: auto;">
              <div style="float: left; width: 120px; height: 170px;">
                <div class="layui-form-item" style="margin-left: 5px;">公司LOGO</div>
                <div id="div_upload_img">
                  <img class="icon_img" src="../../../imgs/upload_img_icon.png" />
                  <span id="span_upload_img_txt">上传PNG</span>
                </div>
                <div class="div_upload_tip">建议尺寸为100*40px</div>
              </div>
              <div style="float: left; width: 120px; height: 170px;">
                <div id="div_upload_img_content">
                  
                </div>
                <div class="div_upload_tip">LOGO图片展示</div>
              </div>
              <div style="float: left; width: 120px; height: 170px;"></div>


              <div style="float: left; width: 120px; height: 170px;">
                <div class="layui-form-item">标题图标</div>
                <div id="div_upload_ico_img">
                  <img class="icon_img" src="../../../imgs/upload_img_icon.png" />
                  <span id="span_upload_img_txt">上传ICO</span>
                </div>
                <div class="div_upload_tip">建议尺寸为48*48px</div>
              </div>
              <div style="float: left; width: 120px; height: 170px;">
                <div id="div_upload_ico_img_content">
                  
                </div>
                <div class="div_upload_tip">ICO图片展示</div>
              </div>
              <div style="clear:both;"></div>
            </div>

            <div style="position: relative; width: 770px; height: 20px; margin: auto;"></div>

            <div style="position: relative; width: 770px; height: auto; margin: auto;">
              <div style="width: 380px; float: left;">
                <div class="layui-form-item">
                  <div class="layui-input-inline" style="width: 360px;">
                    <input type="checkbox" value="1" name="isshowpclogin" lay-skin="primary" lay-filter="isshowpclogin" title="PC端登录页显示logo图标">
                  </div>
                </div>
              </div>
              <div style="width: 380px; float: left;">
                <div class="layui-form-item">
                  <div class="layui-input-inline" style="width: 360px;">
                    <input type="checkbox" value="1" name="isshowico" lay-skin="primary" lay-filter="isshowico" title="页面标题显示logo图标">
                  </div>
                </div>
              </div>
              <div style="clear: both;"></div>
            </div>
            <div style="position: relative; width: 770px; height: 20px; margin: auto;"></div>
            <div style="position: relative; width: 770px; height: auto; margin: auto;">
              <div style="width: 380px; float: left;">
                <div class="layui-form-item">
                  <div class="layui-input-inline" style="width: 360px;">
                    <input type="checkbox" value="1" name="isshowpcleftmenu" lay-skin="primary" lay-filter="isshowpcleftmenu" title="PC端左侧菜单显示logo图标">
                    
                  </div>
                </div>
              </div>
              <div style="width: 380px; float: left;">
                <div class="layui-form-item">
                  <div class="layui-input-inline" style="width: 360px;">
                    
                  </div>
                </div>
              </div>
              <div style="clear: both;"></div>
            </div>



            <div style="position: relative; width: 770px; height: 20px; margin: auto;"></div>
            <div style="position: relative; width: 770px; height: auto; margin: auto;">
              <div style="width: 380px; float: left;display: none;">
                <div class="layui-form-item">
                  <span class="redspan">*</span>企业名称
                </div>
                <div class="layui-form-item">
                  <div class="layui-input-inline" style="width: 360px;">
                    <input type="text" id="L_company" name="company" placeholder="企业名称" lay-verify="required" autocomplete="off" class="layui-input">
                  </div>
                </div>
              </div>
              <div style="width: 380px; float: left;">
                <div class="layui-form-item">
                  <span class="redspan">*</span>产品名称
                </div>
                <div class="layui-form-item">
                  <div class="layui-input-inline" style="width: 360px;">
                      <input type="text" id="L_product" name="product" placeholder="产品名称" lay-verify="required" autocomplete="off" class="layui-input">
                  </div>
                </div>
              </div>
              <div style="width: 380px; float: left;">
                <div class="layui-form-item">
                  <span class="redspan">*</span>企业研发名称
                </div>
                <div class="layui-form-item">
                  <div class="layui-input-inline" style="width: 360px;">
                    <input type="text" id="L_team" name="team" placeholder="报表开发团队" lay-verify="required" autocomplete="off" class="layui-input">
                  </div>
                </div>
              </div>
              <div style="clear: both;"></div>
            </div>

            <div style="position: relative; width: 770px; height: 20px; margin: auto;"></div>
            
            <div style="position: relative; width: 770px; height: auto; margin: auto;">

              <div style="width: 380px; float: left;">
                <div class="layui-form-item">
                  <span class="redspan">*</span>系统名称
                </div>
                <div class="layui-form-item">
                  <div class="layui-input-inline" style="width: 360px;">
                      <input type="text" id="L_name" name="name" placeholder="系统名称" lay-verify="required" autocomplete="off" class="layui-input">
                  </div>
                </div>
              </div>
              
              <div style="clear: both;"></div>
            </div>

            
            <div class="layui-form-item" style="display: none;">
                <label for="L_logo" class="layui-form-label" style="width:100px;">
                    <span class="redspan">*</span>LOGO
                </label>
              <div class="layui-upload-list">
              <button type="button" class="layui-btn" style="position: absolute" id="up_btn"><i class="layui-icon">&#xe67c;</i>图片上传</button>
                <p id="tip" style="margin: 38px 0px 0px 135px;position: absolute">建议尺寸为1290*60</p>
                <img class="layui-upload-img" id="logo_img" style="max-width: 62%;margin-left: 130px">
              </div>
            </div>
  
            <div class="layui-form-item" style="display: none;">
              <label for="L_logo" class="layui-form-label" style="width:100px;">
                <span class="redspan">*</span>设计器
              </label>
              <div class="layui-upload-list">
                <button type="button" class="layui-btn" style="position: absolute;" id="des_btn"><i class="layui-icon">&#xe67c;</i>图片上传</button>
                <p id="des" style="margin: 38px 0px 0px 135px;position: absolute;">
                  建议尺寸为1:1
                </p>
                <img class="layui-upload-img" id="des_img" style="max-width: 62%;margin-left: 130px;" width="100px" height="100px">
              </div>
            </div>
        </form> 
    </div>
</div>
<script src="../../../lib/jquery-3.4.1/jquery-3.4.1.min.js"></script>
<script src="../../../lib/layui-v2.7.6/layui.js" charset="utf-8"></script>
<script src="../../../js/lay-config.js" charset="utf-8"></script>
<script src="../../../js/common.js" charset="utf-8"></script>
<script>
    layui.use(['form','element'], function () {
        var $ = layui.jquery,
            form = layui.form;
        let server_base_url = window.sessionStorage.getItem("ef_server_base_url");
        let token = window.sessionStorage.getItem("cur_token");
        // console.log("当前token--->", token);
        let efurl = server_base_url + "/oem/get?token=" + token;
        let initOEM = function () {
            $.ajax({
                url: efurl,
                type: 'get',
                success: function (res) {
                    // console.log("通过get方式获取oem数据的res的值为：", res);
                    initForm(res);
                },
                error: function () {
                }
            });
        }
        initOEM();

        // 刷新
        $('#btn-refresh').click(function () {
            //重载 数据
            // console.log("oem-----------刷新执行了---------。");
            initOEM();
        });

        let initForm = function(data) {
            $("#id").val(data.id);
            $("input[name='name']").val(data.name);
            $("input[name='company']").val(data.company);
            $("input[name='team']").val(data.team);
            $("input[name='product']").val(data.product);
            // let logimg = server_base_url + "/oem/" + data.logo + "?v=" + new Date().getTime();
            // console.log(logimg);
            // $("#logo_img").attr("src", logimg);

            if (data.logo !== "") {
              let imgurl = server_base_url + "/oem/company.jpg?v=" + new Date().getTime() +"&t=abc";
              let strhtml = "<img src='"+imgurl+"' style='height: 40px; max-height: 40px; width: 100px; max-width:100px;' />";
              $("#div_upload_img_content").html(strhtml);
            }

            if (data.titleico !== "") {
              let imgurl = server_base_url + "/oem/favicon.ico?v=" + new Date().getTime() +"&t=abc";
              let strhtml = "<img src='"+imgurl+"' style='height:48px; max-height: 48px; width: 48px; max-width:48px;' />";
              $("#div_upload_ico_img_content").html(strhtml);
            }

            // let desimg = server_base_url + "/oem/" + data.design + "?v=" + new Date().getTime();
            // $("#des_img").attr("src", desimg);
            form.render();
            form.val("sysoem", {
              "isshowpclogin": data.isshowpclogin == 1 ? "1" : "",
              "isshowpcleftmenu": data.isshowpcleftmenu == 1 ? "1" : "",
              "isshowico": data.isshowico == 1 ? "1" : ""
            });
            form.render();
        };
        $("input[name='name']").change(function(){
            var val = $(this).val();
            if(isNull(val)){
                layer.msg("数据不能为空", {icon:2, time:3000});
                return false;
            }
            let paramData = {
                token: window.sessionStorage.getItem("cur_token"),
                name: val
            };

            // 修改系统名称时，这里要更新
            window.sessionStorage.setItem("sys_name", val);
            updateOem(paramData);
        });
        $("input[name='company']").change(function(){
            var val = $(this).val();
            if(isNull(val)){
                layer.msg("数据不能为空", {icon:2, time:3000});
                return false;
            }
            let paramData = {
                token: window.sessionStorage.getItem("cur_token"),
                company: val
            };
            updateOem(paramData);
        });
        $("input[name='team']").change(function(){
            var val = $(this).val();
            if(isNull(val)){
                layer.msg("数据不能为空", {icon:2, time:3000});
                return false;
            }
            let paramData = {
                token: window.sessionStorage.getItem("cur_token"),
                team: val
            };
            updateOem(paramData);
        });
        $("input[name='product']").change(function(){
            var val = $(this).val();
            if(isNull(val)){
                layer.msg("数据不能为空", {icon:2, time:3000});
                return false;
            }
            let paramData = {
                token: window.sessionStorage.getItem("cur_token"),
                product: val
            };
            updateOem(paramData);
        });
        let updateOem = function(paramData) {
            let server_base_url = window.sessionStorage.getItem("ef_server_base_url");
            let efurl = server_base_url + "/oem/update";
            $.ajax({
                url: efurl,
                type: 'post',
                data: paramData,
                success: function (res) {
                    // console.log("修改oem的值结果为：", res);
                    // loadingTreeTable(res);
                },
                error: function () {
                }
            });
        }

        let updateOem2 = function(paramData) {
            let server_base_url = window.sessionStorage.getItem("ef_server_base_url");
            let efurl = server_base_url + "/oem/updatelogoshow";
            $.ajax({
                url: efurl,
                type: 'post',
                data: paramData,
                success: function (res) {
                    // console.log("修改oem的值结果为：", res);
                    // loadingTreeTable(res);
                },
                error: function () {
                }
            });
        }

        // PC端登录页是否显示logo图标
        form.on("checkbox(isshowpclogin)", function(data) {
            let flag = this.checked;
            // console.log("PC端登录页是否显示logo图标--------flag-->", flag);
            let showpclogin = 0;
            if (flag === true) {
              showpclogin = 1;
            } else {
              showpclogin = 2;
            }
            let paramData = {
                token: window.sessionStorage.getItem("cur_token"),
                isshowpclogin: showpclogin,
                isshowpcleftmenu: 0,
                isshowico: 0
            };
            updateOem2(paramData);
        });

        // PC端左侧菜单是否显示logo图标
        form.on("checkbox(isshowpcleftmenu)", function(data) {
            let flag = this.checked;
            let showpcleftmenu = 0;
            if (flag === true) {
              showpcleftmenu = 1;
            } else {
              showpcleftmenu = 2;
            }

            let paramData = {
                token: window.sessionStorage.getItem("cur_token"),
                isshowpclogin: 0,
                isshowpcleftmenu: showpcleftmenu,
                isshowico: 0
            };
            window.sessionStorage.setItem("isshowpcleftmenu" , showpcleftmenu);
            updateOem2(paramData);
        });

        // pc端标题ico图标是否显示
        form.on("checkbox(isshowico)", function(data) {
            let flag = this.checked;
            // console.log("PC端左侧菜单是否显示logo图标--------flag-->", flag);
            let showico = 0;
            if (flag === true) {
              showico = 1;
            } else {
              showico = 2;
            }

            let paramData = {
                token: window.sessionStorage.getItem("cur_token"),
                isshowpclogin: 0,
                isshowpcleftmenu: 0,
                isshowico: showico
            };
            updateOem2(paramData);
            // form.render();
        });

    });

    
    // 上传logo
    layui.use('upload', function(){
        var $ = layui.jquery,upload = layui.upload;

        let server_base_url = window.sessionStorage.getItem("ef_server_base_url");
        let token = window.sessionStorage.getItem("cur_token");
        let efurl = server_base_url + "/oem/uploadCompanyImage?token=" + token;
        //普通图片上传
        upload.render({
          elem: '#div_upload_img'
          ,url: efurl
          ,method: 'POST'
          ,accept: 'file'
          ,exts: 'bmp|jpg|png|tif|gif|ico|jpeg' //只允许上传压缩文件
          ,before: function(obj){

          }
          ,done: function(res){
            if(res.state === "success"){

              layer.msg(res.message);
              // layer.msg(res.message, {icon: 6, time:2000},function(){
              //   let imgurl = server_base_url + "/oem/company.jpg?v=" + new Date().getTime() +"&t=abc";
              //   console.log("imgurl------>", imgurl);
              //   // location.reload(true);
              //   // $("#logo_img").attr("src", "");
              //   // $("#logo_img").attr("src", imgurl);

              //   let strhtml = "<img src='"+imgurl+"' style='max-height: 110px; max-width:110px;' />";
              //   $("#div_upload_img").html(strhtml);
              // });
              
              let cur_timer = window.setInterval(function(){
                $("#div_upload_img_content").html("");
                let imgurl = server_base_url + "/oem/company.jpg?v=" + new Date().getTime() +"&t=abc";
                let strhtml = "<img src='"+imgurl+"' style='height: 40px; max-height: 40px; width: 100px; max-width:100px;' />";
                $("#div_upload_img_content").html(strhtml);
              }, 2000 * 4);

              let clear_cur_timer = window.setInterval(function(){
                window.clearInterval(cur_timer);
                window.clearInterval(clear_cur_timer);
              }, 2005 * 12);

            } else {
              layer.msg(res.message, {icon:1, time:1000});
            }
          }
        });
    
    
      });

    




    layui.use('upload', function(){
        var $ = layui.jquery,upload = layui.upload;

        let server_base_url = window.sessionStorage.getItem("ef_server_base_url");
        let token = window.sessionStorage.getItem("cur_token");
        let efurl = server_base_url + "/oem/uploadTitleImage?token=" + token;
        //普通图片上传
        upload.render({
          elem: '#div_upload_ico_img'
          ,url: efurl
          ,method: 'POST'
          ,accept: 'file'
          ,exts: 'jpg|png|tif|gif|ico|jpeg' //只允许上传压缩文件
          ,before: function(obj){
            /*obj.preview(function(index, file, result){
              $('#demo2').append('<img src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')
            });*/
          }
          ,done: function(res){
            if(res.state === "success"){
              layer.msg(res.message);
              // layer.msg(res.message, {icon: 6, time:2000},function(){
              //   let imgurl = server_base_url + "/oem/favicon.ico?v=" + new Date().getTime() +"&t=abc";
              //   // location.reload(true);
              //   $("#logo_img").attr("src", "");
              //   $("#logo_img").attr("src", imgurl);
              // });


              let cur_ico_timer = window.setInterval(function(){
                $("#div_upload_ico_img_content").html("");
                let imgurl = server_base_url + "/oem/favicon.ico?v=" + new Date().getTime() +"&t=abc";
                let strhtml = "<img src='"+imgurl+"' style='height:48px; max-height: 48px; width: 48px; max-width:48px;' />";
                $("#div_upload_ico_img_content").html(strhtml);
              }, 2000 * 4);

              let clear_cur_ico_timer = window.setInterval(function(){
                window.clearInterval(cur_ico_timer);
                window.clearInterval(clear_cur_ico_timer);
              }, 2005 * 12);

            } else {
              layer.msg(res.message, {icon:1, time:1000});
            }
          }
        });
    });
    layui.use('upload', function () {
      var $ = layui.jquery, upload = layui.upload;
      let server_base_url = window.sessionStorage.getItem("ef_server_base_url");
        let token = window.sessionStorage.getItem("cur_token");
        let efurl = server_base_url + "/oem/uploadDesignImage?token=" + token;
      upload.render({
        elem: '#des_btn'
        , url: efurl
        , method: 'POST'
        , accept: 'file'
        , exts: 'bmp|jpg|png|tif|gif|ico|jpeg'
        , before: function (obj) {}
        , done: function (res) {
          if (res.state === "success") {
            layer.msg(res.message, {icon: 6, time: 2000}, function () {
                let imgurl = server_base_url + "/oem/design.jpg?v=" + new Date().getTime() + "&t=abc";
                $("#des_img").attr("src", "");
                $("#des_img").attr("src", imgurl);
            });
          } else {
            layer.msg(res.message, {icon: 1, time: 1000});
          }
        }
      });
    });
</script>
<style>
  .redspan {
      color: red;
  }
  /* 设置滚动条样式 */
  ::-webkit-scrollbar {
      width: 4px;
      height: 1px;
  }
  /* 设置滚动条样式 */
  ::-webkit-scrollbar-thumb {
      border-radius: 10px;
      box-shadow: inset 0 0 5px rgba(97, 184, 179, 0.1);
      background: #d5d5d5;
  }
  /* 设置滚动条样式 */
  ::-webkit-scrollbar-track {
      box-shadow: inset 0 0 5px rgba(87, 175, 187, 0.1);
      border-radius: 10px;
      background: #ffffff;
  }
</style>
</body>
</html>