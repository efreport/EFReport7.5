<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="keywords" content="数据报表">
    <meta name="description" content="数据报表">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link id="iconLink" rel="icon" href="data:;base64,=">
    <link rel="stylesheet" href="lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="css/layuimini.css?v=2.0.4.2" media="all">
    <link rel="stylesheet" href="css/themes/default.css" media="all">
    <link rel="stylesheet" href="lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <style id="layuimini-bg-color">
    </style>
</head>
<body class="layui-layout-body layuimini-all">
<div class="layui-layout layui-layout-admin">

    <div class="layui-header header">
        <div class="layui-logo layuimini-logo"></div>

        <div class="layuimini-header-content">
            <a>
                <div class="layuimini-tool"><i title="展开" class="fa fa-outdent" data-side-fold="1"></i></div>
            </a>

            <!--电脑端头部菜单-->
            <ul class="layui-nav layui-layout-left layuimini-header-menu layuimini-menu-header-pc layuimini-pc-show">
            </ul>

            <!--手机端头部菜单-->
            <ul class="layui-nav layui-layout-left layuimini-header-menu layuimini-mobile-show">
                <li class="layui-nav-item">
                    <a href="javascript:;"><i class="fa fa-list-ul"></i> 选择模块</a>
                    <dl class="layui-nav-child layuimini-menu-header-mobile">
                    </dl>
                </li>
            </ul>
        </div>
    </div>

    <div class="layui-side" style="top: 0px !important; background-color: #F2F3F5;">

        <div id="div_left_menu_header" style='background-color: #F2F3F5; height: 40px; text-align: center; margin-top: 20px; margin-bottom: 20px;'>
            <img id="company_logo_img" src='' style="max-width: 100px; max-height: 40px;" />
        </div>
        <div id="zhedie_div">
            <img src="imgs/sj_icon.png" style="width: 18px; height: 18px; border: 0px;" />
        </div>
        <div class="layuimini-menu-left">

        </div>
    </div>

    <!--初始化加载层-->
    <div class="layuimini-loader">
        <div class="layuimini-loader-inner"></div>
    </div>

    <div class="layui-body" style="top: 0px !important; background-color: #fcfcfc !important;">

        <div class="layuimini-tab layui-tab-rollTool layui-tab" lay-filter="layuiminiTab" lay-allowclose="true" style="position: relative;">
            <ul class="layui-tab-title" style="width: 95%; padding: 0px;">
                <li class="layui-this" id="layuiminiHomeTabId" lay-id=""></li>
            </ul>
            <div style="position: absolute; width: 5%; min-width: 100px; height: 35px; line-height: 35px; top: 0px; right: 0px;">
                <div id="div_cur_account">
                    <ul class="layui-nav" style="height: 35px !important; line-height: 35px !important; color: #000000 !important;">
                        <li class="layui-nav-item layuimini-setting" style="height: 35px !important; line-height: 35px !important;">
                            <a id="a_cur_account" href="javascript:;"></a>
                            <dl class="layui-nav-child" style="top: 40px !important;">
                                <dd>
                                    <a id="a_update_pwd" href="javascript:;" layuimini-content-href="page/sys/user/user-password.html" data-title="修改密码" data-icon="fa fa-gears">修改密码</a>
                                </dd>
                                <dd>
                                    <a id="btn_page_cancel" href="javascript:;" data-title="退出登录" data-icon="fa fa-gears">退出登录</a>
                                </dd>
                            </dl>
                        </li>
                    </ul>
                </div>
                <div style="height: 35px; line-height: 35px; float: left;display: none;">
                    <button>退出</button>
                </div>
                <div style="clear: both;"></div>
            </div>
            
            <div class="layui-tab-control" style="display: none;">
                <li class="layuimini-tab-roll-left layui-icon layui-icon-left"></li>
                <li class="layuimini-tab-roll-right layui-icon layui-icon-right"></li>
                <li class="layui-tab-tool layui-icon layui-icon-down">
                    <ul class="layui-nav close-box">
                        <li class="layui-nav-item">
                            <a href="javascript:;"><span class="layui-nav-more"></span></a>
                            <dl class="layui-nav-child">
                                <dd><a href="javascript:;" layuimini-tab-close="current">关 闭 当 前</a></dd>
                                <dd><a href="javascript:;" layuimini-tab-close="other">关 闭 其 他</a></dd>
                                <dd><a href="javascript:;" layuimini-tab-close="all">关 闭 全 部</a></dd>
                            </dl>
                        </li>
                    </ul>
                </li>
            </div>
            <div class="layui-tab-content">
                <div id="layuiminiHomeTabIframe" class="layui-tab-item layui-show"></div>
            </div>
        </div>

    </div>
</div>
<div id="div_update_pwd">
    <a href="javascript:;" layuimini-content-href="page/sys/user/user-password.html" data-title="修改密码" data-icon="fa fa-gears">修改密码</a>
</div>

<script src="lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
<script src="lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script src="js/lay-config.js?v=2.0.0" charset="utf-8"></script>
<script src="js/checklogin.js"></script>
<script src="js/common.js"></script>

<script>
    let base;
    $(function(){
        base = window.sessionStorage.getItem("base");
        $("#zhedie_div").click(function(){
            var isShow = $('.layuimini-tool [data-side-fold]').attr('data-side-fold');
            if (isShow == 1) { // 缩放
                $("#div_left_menu_header").hide();
                let width = $(".layui-side").width();
                $(".layui-side").width(60);
                $("#zhedie_div").css("left", "60px");
                let zkImgStr = '<img src="imgs/zk_icon.png" style="width: 18px; height: 18px; border: 0px;" />';
                $("#zhedie_div").html(zkImgStr);
                $('.layuimini-tool [data-side-fold]').attr('data-side-fold', 0);
                $('.layuimini-tool [data-side-fold]').attr('class', 'fa fa-indent');
                $('.layui-layout-body').removeClass('layuimini-all');
                $('.layui-layout-body').addClass('layuimini-mini');
            } else { // 正常
                let isshowpcleftmenu =  window.sessionStorage.getItem("isshowpcleftmenu");
                if(isshowpcleftmenu === "1") {
                    $("#div_left_menu_header").show();
                }
                $(".layui-side").width(200);
                $("#zhedie_div").css("left", "200px");
                let sjImgStr = '<img src="imgs/sj_icon.png" style="width: 18px; height: 18px; border: 0px;" />';
                $("#zhedie_div").html(sjImgStr);
                $('.layuimini-tool [data-side-fold]').attr('data-side-fold', 1);
                $('.layuimini-tool [data-side-fold]').attr('class', 'fa fa-outdent');
                $('.layui-layout-body').removeClass('layuimini-mini');
                $('.layui-layout-body').addClass('layuimini-all');
                // layer.close(window.openTips);
            }
        });
    });

    /**
     * 间隔1.5秒，清除掉右侧下来菜单的layui-this类样式
     */
    function runTimeClearLayuiThisCls() {
        let cc_cur_timer = window.setInterval(function(){
            $("#a_cur_account").next().children("dd").each(function(){
                $(this).removeClass('layui-this');
            });
            window.clearInterval(cc_cur_timer);
        }, 1000);
    }

    layui.use(['jquery', 'layer', 'miniAdmin'], function () {
        var $ = layui.jquery,
            layer = layui.layer,
            miniAdmin = layui.miniAdmin;

        let pageload = function () {
        let caccount = window.sessionStorage.getItem("cur_accout");
            $("#a_cur_account").html(caccount);
        }
        pageload();

        $("#a_update_pwd").click(function(){
            runTimeClearLayuiThisCls();
        });

        let companyid = window.sessionStorage.getItem("cur_companyid");

        let cur_json_url = "";
        if (companyid<=1) {
            cur_json_url="api/admin.json";
        } else {
            cur_json_url="api/admin2.json";
        }


        var options = {
            iniUrl: cur_json_url,    // 初始化接口
            clearUrl: "api/clear.json", // 缓存清理接口
            urlHashLocation: true,      // 是否打开hash定位
            bgColorDefault: false,      // 主题默认配置
            multiModule: true,          // 是否开启多模块
            menuChildOpen: false,       // 是否默认展开菜单
            loadingTime: 0,             // 初始化加载时间
            pageAnim: true,             // iframe窗口动画
            maxTabNum: 30,              // 最大的tab打开数量
        };
        miniAdmin.render(options);
        // 因为在miniAdmin.js中，render方法中我们已经屏蔽掉了首页的执行，所以这里必须手动执行一下
        miniAdmin.renderHome({href: "page/welcome-1.html?t=1", title: "首页" });
        let server_base_url = window.sessionStorage.getItem("ef_server_base_url");
        // $("#iconLink").attr("href", server_base_url+"/oem/favicon.ico?tt=" + new Date().getTime());
        let sysname = window.sessionStorage.getItem("sys_name");
        if (sysname !== "") {
            $("title").html(sysname);
        }
        let token = window.sessionStorage.getItem("cur_token");
        let efurl = server_base_url + "/setting/load?token=" + token;
        let initpage = function() {
            // 获取系统设置
            $.ajax({
                url: efurl,
                type: 'get',
                success: function (res) {
                    if(res.state === "success") {
                        if (res.data === "") {
                            
                        } else {
                            if (res.data.isOpenPwdLock === 1) {
                                window.sessionStorage.setItem("isOpenPwdLock", "1");
                            } else {
                                window.sessionStorage.setItem("isOpenPwdLock", "0");
                            }
                        }
                    } else {
                        layer.msg(res.message);
                    }
                    
                },
                error: function () {
                }
            });

            let efurl_oem = server_base_url + "/oem/get";
            $.ajax({
                url: efurl_oem,
                type: 'get',
                success: function (res) {
                    window.sessionStorage.setItem("isshowpcleftmenu", res.isshowpcleftmenu);
                    window.sessionStorage.setItem("isshowico", res.isshowico);
                    if (res.isshowpcleftmenu === 1) {
                        $("#div_left_menu_header").show();
                        $("#company_logo_img").attr("src", server_base_url+"/oem/company.jpg?tt=" + new Date().getTime());
                    } else {
                        $("#div_left_menu_header").hide();
                    }

                    if (res.isshowico === 1) {
                        $("#iconLink").attr("href", server_base_url+"/oem/favicon.ico?tt=" + new Date().getTime());
                    }else {
                        $("#iconLink").attr("href", "data:;base64,=");
                    }
                    
                },
                error: function () {
                }
            });


        }
        initpage();

        let efurl2 = server_base_url + "/user/validatePwdOutRemind?token=" + token;
        let pwdValidateOutTime = function() {
            $.ajax({
                url: efurl2,
                type: 'get',
                success: function (res) {
                    if (res.state === "failed") {
                        // layer.msg(res.message);
                        window.alert(res.message);
                    }
                },
                error: function () {
                }
            });
        }

        pwdValidateOutTime();


        $('.login-out').on("click", function () {
            window.sessionStorage.setItem("cur_accout", "");
            window.sessionStorage.setItem("cur_token", "");
            window.sessionStorage.setItem("cur_userType", "");
            logout();
        });
        $("#div_cur_account").on("mouseover", function(){

        });
        $('#btn_page_cancel').on("click", function () {
            let efurl_logout = server_base_url + "/user/logout?token=" + token;
            $.ajax({
                url: efurl_logout,
                type: 'get',
                success: function (res) {
                    if (res.state === "success") {
                        window.sessionStorage.setItem("cur_accout", "");
                        window.sessionStorage.setItem("cur_token", "");
                        window.sessionStorage.setItem("cur_userType", "");
                        logout();
                    }
                },
                error: function () {
                    window.sessionStorage.setItem("cur_accout", "");
                    window.sessionStorage.setItem("cur_token", "");
                    window.sessionStorage.setItem("cur_userType", "");
                    logout();

                }
            });

            
        });
    });
</script>
</body>
</html>
<script>
    $(function(){

        function init_table_height() {
            // 获取body的高度
            let body_height = $("body").height();
            let layui_side_height = $(".layui-side").height();
            let left_menu_header_height = $("#div_left_menu_header").height();

            let div_search_temp_height = $("#div_search_temp").height();
            let left_menu_height = layui_side_height - left_menu_header_height - div_search_temp_height - 50;

            $(".layuimini-menu-left").css("height", ""+left_menu_height+"px");
            $("#zhedie_div").css("top", layui_side_height/2 + "px");

        }
        init_table_height();

        $(window).resize(function () {
            // 获取body的高度
            let body_height = $("body").height();
            let layui_side_height = $(".layui-side").height();
            let left_menu_header_height = $("#div_left_menu_header").height();
            let div_search_temp_height = $("#div_search_temp").height();
            let left_menu_height = layui_side_height - left_menu_header_height - div_search_temp_height - 50;

            $(".layuimini-menu-left").css("height", ""+left_menu_height+"px");
            $("#zhedie_div").css("top", layui_side_height/2 + "px");
        });
    });

    function logout(target) {
        window.sessionStorage.removeItem("cur_token");
        if(target == undefined){
            window.location.assign(base);
        }else{
            window.location.assign(target + '/login.html');
        }
    }

</script>
<style>
    /* hk->20221223加入背景色为#fcfcfc */
    body {
        background-color: #FCFCFC !important;
    }
    /* 缩进样式 */
    #zhedie_div {
        position: fixed; top: 490px; left: 200px; z-index: 100; width: 18px; height: 18px; line-height: 18px; background-color: #ffffff;
        border-radius: 0px 20px 20px 0px;
        border: 1px solid #E5E5E5;
    }
    #zhedie_div:hover {
        cursor: pointer;
    }
    #multi_module_0HeaderId {
        width: 0px !important;
        background-color: #ffffff !important;
        text-indent: -1000px;
    }
    .header {
        display: none;
    }
    .layui-nav {
        background-color: #F2F3F5 !important;
    }
    .layui-nav-itemed>.layui-nav-child {
        background-color: #F2F3F5 !important;
    }
    #div_cur_account {
        height: 35px; line-height: 35px;
    }
    #div_cur_account:hover {
        cursor: pointer;
    }
    #div_update_pwd {
        display: none;
        position: absolute;
        z-index: 999;
        width: 100px;
        height: 35px;
        line-height: 35px;
        vertical-align: middle;
        text-align: center;
        top: 35px;
        left: 1500px;
        border: 1px solid #F2F3F5;
        background-color: #F2F3F5;
    }
    #a_cur_account {
        color: #000000 !important;
    }
    a:hover {
        color: #000000 !important;
    }

    #a_cur_account span {
        display: none;
    }
    .layui-layout-admin .layui-body {
        padding-bottom: 0px !important;
    }

    .layui-nav .layui-nav-child dd.layui-this a, .layui-nav-child dd.layui-this {
        /* background-color: #C9C8C6 !important; */
        color: #000000 !important;
    }

    /* 设置滚动条样式 */
    ::-webkit-scrollbar {
        width: 4px;
        height: 1px;
    }
    /* 设置滚动条样式 */
    ::-webkit-scrollbar-thumb {
        border-radius: 10px;
        box-shadow: inset 0 0 5px rgba(97, 184, 179, 0.1);
        background: #d5d5d5;
    }
    /* 设置滚动条样式 */
    ::-webkit-scrollbar-track {
        box-shadow: inset 0 0 5px rgba(87, 175, 187, 0.1);
        border-radius: 10px;
        background: #ffffff;
    }
</style>
