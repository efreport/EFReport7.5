<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, no-store">
    <meta http-equiv="expires" content="0">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../js/css/layui.css">
    <link rel="stylesheet" href="../../js/zTree/css/zTreeStyle.css" type="text/css">
    <style type="text/css">
        html {
            width: 100%;
            height: 100%;
        }

        body {
            width: 100%;
            height: 100%;
        }

        textarea{
            border: 1px solid #ccc;
            background-color: #F2F3F5;
        }

        textarea:hover {
            background-color: #FFFFFF;
            border-color: #44B4FF;
        }

        button{
            border-radius: 4px;
            width: 80px;
            height: 26px;
            line-height: 20px;
            background-color: #0094FF;
            color: #FFFFFF;
            border:0px;
        }

    </style>
</head>
<body>
<div style="display:flex;align-items: center;justify-content: center;width:100%;height:100%;">
    <div style="width:1%;height:100%;">
    </div>
    <div style="width:49%;height:100%;">
        <div class="layui-tab" style="padding:0px;margin: 0px;height:100%;">
            <ul class="layui-tab-title" style="height:6%;">
                <li class="layui-this">运行代码</li>
                <li>默认代码</li>
            </ul>
            <div class="layui-tab-content" style="padding: 0px;height:93%;">
                <div class="layui-tab-item layui-show" style="height: 100%;">
                    <div style="width:99%;height:98%;">
                        <div style="height:5%;padding:5px;display: flex;align-items: center;justify-content: flex-start;">
                            插件数据(默认数据变量为pluginData)
                        </div>
                        <div style="height:20%;">
                            <textarea id="pluginData" style="width:99%;height:99%;resize: none;">

                            </textarea>
                        </div>
                        <div style="height:5%;padding:5px;display: flex;align-items: center;justify-content: flex-start;">
                            插件option
                        </div>
                        <div style="height:60%;">
                            <textarea id="pluginOption" style="width:99%;height:99%;resize: none;">

                            </textarea>
                        </div>
                    </div>
                </div>
                <div class="layui-tab-item" style="height: 100%;">
                    <div class="btn-wrap" style="height:7%;display:flex;align-items: center;justify-content: flex-end;">
                        <button id="submit">运行</button>
                    </div>
                    <pre id="editor" style="width:100%;height:91%;"></pre>
                </div>
            </div>
        </div>
    </div>
    <div style="width: 50%;height:100%;">
        <div style="height:7%;"></div>
        <div style="width:100%;height:91%;" id="main"></div>
    </div>
</div>


</body>
<script type="text/javascript" src="../../js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="../../js/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="../../js/echarts-5.4.2.min.js" charset="utf-8"></script>
<script type="text/javascript" src="../../js/echarts-gl.min.js" charset="utf-8"></script>
<script type="text/javascript" src="../../js/ace.js" charset="utf-8"></script>
<script type="text/javascript">
    let myChart;
    let editor;
    layui.use(['layer', 'element'], function () {
        layer = layui.layer;
        element = layui.element;
    });

    $(document).ready(function () {
        editor = ace.edit("editor");
        editor.setOptions({
            enableBasicAutocompletion: true, //启用基本自动完成
            enableSnippets: true, //启用代码段
            enableLiveAutocompletion: true, // 启用实时自动完成
            wrap: true, //开启换行
        });

        let submit = $('#submit');
        submit.unbind().bind('click', function () {
            // 获取编辑器里的配置代码
            let script = editor.getValue();
            myChart = echarts.init(document.getElementById('main'));
            // 更改图表前先清空当前图表
            myChart.clear();
            // 更新图表
            changeChart(script);
        })
    })

    function getChartOptionsStr(el, option) {
        let str;
        // 将传入的option对象转为字符串,第三个参数2表示字符串缩进2个空格
        option = JSON.stringify(option, null, 2)
        str = `option = ${option};`;
        return str;
    }

    // 更改图表
    function changeChart(script) {
        try {
            let func = new Function(`var option;var myChart = echarts.init(document.getElementById('main'));` + script + `myChart.setOption(option);`);
            func()
        } catch (e) {
            console.log('编辑有误')
        }
    }

    function getPluginInfos(){
        let pluginInfo = {};
        pluginInfo.PluginData = JSON.parse($('#pluginData').val());
        pluginInfo.PluginOption = $('#pluginOption').val();
        pluginInfo.PluginDefaultOption = editor.getValue();
        return pluginInfo;
    }

    function initPluginInfos(pluginInfo){
        let plugin = JSON.parse(pluginInfo);
        $('#pluginData').val(JSON.stringify(plugin.PluginData));
        $('#pluginOption').val(plugin.PluginOption);
        editor.setValue(plugin.PluginDefaultOption);
        let submit = $('#submit');
        submit.trigger('click');
    }

</script>
</html>